<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB Psychology 2027 Master Suite</title>
<style>
    :root {
        --nav-width: 270px;
        --dark-bg: #0f172a;
        --ib-blue: #0ea5e9;
        --accent-green: #10b981;
        --border: #e2e8f0;
        --text-main: #1e293b;
        --text-muted: #64748b;
    }

    body { font-family: 'Inter', -apple-system, system-ui, sans-serif; margin: 0; display: flex; background: #f8fafc; color: var(--text-main); }

    /* SIDEBAR */
    #sidebar { width: var(--nav-width); height: 100vh; background: var(--dark-bg); color: white; position: fixed; overflow-y: auto; z-index: 1000; }
    #sidebar header { padding: 20px; border-bottom: 1px solid #1e293b; text-align: center; }
    #sidebar header h2 { font-size: 1rem; margin: 0; color: #38bdf8; letter-spacing: 1px; }
    
    .nav-cat { padding: 15px 20px 5px; font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 1.2px; font-weight: 700; }
    #sidebar ul { list-style: none; padding: 0; margin: 0; }
    #sidebar li a { display: block; padding: 10px 20px; color: #cbd5e1; text-decoration: none; font-size: 0.85rem; cursor: pointer; transition: 0.2s; border-left: 3px solid transparent; }
    #sidebar li a:hover { background: #1e293b; color: white; }
    #sidebar li a.active { background: var(--ib-blue); color: white; border-left: 3px solid #fff; }

    /* MAIN CONTAINER */
    .container { margin-left: var(--nav-width); padding: 40px; width: calc(100% - var(--nav-width)); max-width: 950px; padding-bottom: 180px; box-sizing: border-box; }
    .view { display: none; }
    .view.active { display: block; animation: fadeIn 0.2s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    .guide-ref { font-size: 0.75rem; color: var(--ib-blue); font-weight: bold; text-transform: uppercase; margin-bottom: 5px; display: block; }
    h1 { font-size: 1.6rem; color: var(--dark-bg); border-bottom: 2px solid var(--ib-blue); padding-bottom: 10px; margin: 0 0 10px; }
    .page-desc { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 20px; }

    /* INPUT FIELDS */
    .context-box { background: #f1f5f9; padding: 15px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 20px; }
    .context-box label { display: block; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; color: var(--text-muted); margin-bottom: 5px; }
    .q-input { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 4px; font-family: inherit; font-size: 0.9rem; }

    /* RUBRIC CARDS */
    .card { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    .strand-title { font-weight: 800; color: var(--ib-blue); text-transform: uppercase; font-size: 0.7rem; letter-spacing: 0.5px; display: block; margin-bottom: 12px; }
    
    .row-opt { display: flex; align-items: flex-start; padding: 12px; border-radius: 8px; border: 1px solid #f8fafc; cursor: pointer; transition: 0.1s; margin-bottom: 4px; }
    .row-opt:hover { background: #f0f9ff; border-color: #bae6fd; }
    .row-opt input { margin-top: 4px; margin-right: 15px; transform: scale(1.3); }
    
    .mark-tag { font-weight: 700; min-width: 60px; font-size: 0.7rem; padding: 3px 6px; border-radius: 4px; background: #e2e8f0; margin-right: 15px; text-align: center; color: #475569; }
    .txt-body { font-size: 0.95rem; line-height: 1.5; color: #334155; }
    .kw { font-weight: 700; color: #000; background: #fffbeb; padding: 0 2px; }

    /* EXPORT MANAGER */
    .export-row { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--border); }
    .export-row.disabled { opacity: 0.4; pointer-events: none; background: #f1f5f9; }
    .export-row input { margin-right: 15px; width: 18px; height: 18px; }

    /* BOTTOM DOCK */
    .dock-bar { position: fixed; bottom: 0; left: var(--nav-width); right: 0; background: white; border-top: 4px solid var(--ib-blue); padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -10px 30px rgba(0,0,0,0.1); z-index: 2000; }
    .res-val { font-size: 2.2rem; font-weight: 900; color: var(--ib-blue); line-height: 1; }
    .res-lbl { font-size: 0.65rem; font-weight: 800; color: #64748b; text-transform: uppercase; margin-top: 5px; }

    textarea { width: 100%; height: 100px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; margin-top: 15px; font-family: inherit; font-size: 0.9rem; resize: vertical; box-sizing: border-box; }
    .btn { padding: 10px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; border: none; transition: 0.2s; font-size: 0.8rem; }
    .btn-blue { background: var(--ib-blue); color: white; }
    .btn-green { background: var(--accent-green); color: white; margin-left: 10px; }
    .btn-orange { background: #f97316; color: white; width: 100%; margin-top: 10px; }
    .btn-red { background: #ef4444; color: white; width: 100%; margin-top: 10px; }

    .manual-grade-field { width: 80px; text-align: center; font-weight: 900; color: var(--ib-blue); border: 2px solid var(--ib-blue); padding: 10px; border-radius: 8px; font-size: 1.2rem; }
</style>
</head>
<body>

<nav id="sidebar">
    <header><h2>Psych Marker 2027</h2></header>
    <div class="nav-cat">Paper 1</div>
    <ul>
        <li><a onclick="nav('p1a')" id="btn-p1a" class="active">P1-A: SAQ</a></li>
        <li><a onclick="nav('p1b')" id="btn-p1b">P1-B: Applied SAQ</a></li>
        <li><a onclick="nav('p1c')" id="btn-p1c">P1-C: ERQ (Essay)</a></li>
    </ul>
    <div class="nav-cat">Paper 2</div>
    <ul>
        <li><a onclick="nav('p2aq1')" id="btn-p2aq1">P2-A-Q1: Knowledge</a></li>
        <li><a onclick="nav('p2aq2')" id="btn-p2aq2">P2-A-Q2: Application</a></li>
        <li><a onclick="nav('p2aq3')" id="btn-p2aq3">P2-A-Q3: Compare</a></li>
        <li><a onclick="nav('p2aq4')" id="btn-p2aq4">P2-A-Q4: Design</a></li>
        <li><a onclick="nav('p2b')" id="btn-p2b">P2-B: Unseen Case</a></li>
    </ul>
    <div class="nav-cat">Paper 3</div>
    <ul>
        <li><a onclick="nav('p3q1')" id="btn-p3q1">P3-Q1: Data Skill</a></li>
        <li><a onclick="nav('p3q2')" id="btn-p3q2">P3-Q2: Conclusion</a></li>
        <li><a onclick="nav('p3q3')" id="btn-p3q3">P3-Q3: Ethics</a></li>
        <li><a onclick="nav('p3q4')" id="btn-p3q4">P3-Q4: Synthesis</a></li>
    </ul>
    <div class="nav-cat">Internal</div>
    <ul>
        <li><a onclick="nav('ia')" id="btn-ia">IA: Research Proposal</a></li>
    </ul>
    <div class="nav-cat">Tools</div>
    <ul>
        <li><a onclick="nav('export')" id="btn-export" style="color: #38bdf8; font-weight: bold;">Export Manager</a></li>
        <li><a onclick="nav('help')" id="btn-help">Help & Pedagogy</a></li>
    </ul>
    <div style="padding: 10px 20px;">
        <button class="btn btn-orange" onclick="resetRubrics()">Reset Rubrics & Comments</button>
        <button class="btn btn-red" onclick="resetAll()">Reset All (Full Clear)</button>
    </div>
</nav>

<div class="container">
    
    <!-- TEMPLATE FOR EACH SECTION -->
    <template id="section-header">
        <div class="context-box">
            <label>Question / Prompt being assessed</label>
            <input type="text" class="q-input q-field" placeholder="Enter the specific question text here...">
        </div>
    </template>

    <!-- PAPER 1 SECTION A -->
    <div id="p1a" class="view active">
        <span class="guide-ref">Guide Page 51</span>
        <h1>P1-A: Short Answer Question</h1>
        <div class="header-anchor"></div>
        <div class="card">
            <span class="strand-title">Knowledge & Understanding</span>
            <label class="row-opt"><input type="radio" name="p1as1" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">The response demonstrates <span class="kw">limited knowledge</span> relevant to the question.</div></label>
            <label class="row-opt"><input type="radio" name="p1as1" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">The response demonstrates <span class="kw">detailed knowledge</span> relevant to the question.</div></label>
        </div>
        <div class="card">
            <span class="strand-title">Relevance of Example</span>
            <label class="row-opt"><input type="radio" name="p1as2" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">The example is relevant but is <span class="kw">not explained</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1as2" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">The example is relevant and <span class="kw">explained</span>.</div></label>
        </div>
        <div class="context-box">
            <label>Manual Mark Entry (Overrides Prediction)</label>
            <input type="number" class="manual-grade-field" id="man-p1a" oninput="upd()">
        </div>
        <textarea id="comm-p1a" placeholder="Comment" oninput="save()"></textarea>
    </div>

    <!-- P1-B -->
    <div id="p1b" class="view">
        <span class="guide-ref">Guide Page 51-52</span>
        <h1>P1-B: Applied Short Answer</h1>
        <div class="header-anchor"></div>
        <div class="card">
            <span class="strand-title">Knowledge and understanding</span>
            <label class="row-opt"><input type="radio" name="p1bs1" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">Knowledge and understanding of the question are <span class="kw">limited</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1bs1" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">Knowledge and understanding have some detail and are <span class="kw">mostly accurate</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1bs1" value="3" onchange="upd()"><span class="mark-tag">5-6</span><div class="txt-body">Knowledge and understanding are <span class="kw">accurate and detailed</span>.</div></label>
        </div>
        <div class="card">
            <span class="strand-title">Application of knowledge</span>
            <label class="row-opt"><input type="radio" name="p1bs2" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">The application of knowledge is relevant but <span class="kw">limited</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1bs2" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">The application of knowledge is relevant and <span class="kw">partially developed</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1bs2" value="3" onchange="upd()"><span class="mark-tag">5-6</span><div class="txt-body">The application of relevant knowledge is <span class="kw">well developed</span>.</div></label>
        </div>
        <div class="context-box">
            <label>Manual Mark Entry</label>
            <input type="number" class="manual-grade-field" id="man-p1b" oninput="upd()">
        </div>
        <textarea id="comm-p1b" placeholder="Comment" oninput="save()"></textarea>
    </div>

    <!-- P1-C -->
    <div id="p1c" class="view">
        <span class="guide-ref">Guide Page 52-53</span>
        <h1>P1-C: Extended Response (Essay)</h1>
        <div class="header-anchor"></div>
        <div class="card">
            <span class="strand-title">Understanding Demands & Knowledge</span>
            <label class="row-opt"><input type="radio" name="p1cs1" value="1" onchange="upd()"><span class="mark-tag">1-3</span><div class="txt-body">The response indicates <span class="kw">little understanding</span> of the demands of the question. Knowledge... are very limited and contain inaccuracies.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs1" value="2" onchange="upd()"><span class="mark-tag">4-6</span><div class="txt-body">The response indicates <span class="kw">some understanding</span> of the demands of the question. Relevant knowledge... are <span class="kw">described</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs1" value="3" onchange="upd()"><span class="mark-tag">7-9</span><div class="txt-body">Understanding of the demands are <span class="kw">partially addressed</span>. Relevant knowledge... are <span class="kw">partly explained</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs1" value="4" onchange="upd()"><span class="mark-tag">10-12</span><div class="txt-body">The demands of the question are <span class="kw">addressed</span>. Relevant knowledge... are <span class="kw">mostly explained</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs1" value="5" onchange="upd()"><span class="mark-tag">13-15</span><div class="txt-body">The demands of the question are <span class="kw">fully explained</span>. Relevant knowledge... are <span class="kw">fully explained</span>.</div></label>
        </div>
        <div class="card">
            <span class="strand-title">Critical Analysis & Synthesis</span>
            <label class="row-opt"><input type="radio" name="p1cs2" value="1" onchange="upd()"><span class="mark-tag">1-3</span><div class="txt-body">Any analysis present is <span class="kw">superficial or incoherent</span>. Links are not stated or not relevant.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs2" value="2" onchange="upd()"><span class="mark-tag">4-6</span><div class="txt-body">There is <span class="kw">limited analysis</span> present and overall the response is more descriptive than it is analytical.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs2" value="3" onchange="upd()"><span class="mark-tag">7-9</span><div class="txt-body">The response contains analysis, although this <span class="kw">lacks development</span>. Links are <span class="kw">partly relevant</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs2" value="4" onchange="upd()"><span class="mark-tag">10-12</span><div class="txt-body">The response contains critical analysis, although this <span class="kw">lacks development</span>. Links are <span class="kw">included and explained</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs2" value="5" onchange="upd()"><span class="mark-tag">13-15</span><div class="txt-body">The response contains <span class="kw">well-developed critical analysis</span>. Links are <span class="kw">fully explained</span>.</div></label>
        </div>
        <div class="card">
            <span class="strand-title">Terminology & Conclusion</span>
            <label class="row-opt"><input type="radio" name="p1cs3" value="1" onchange="upd()"><span class="mark-tag">1-3</span><div class="txt-body">Terminology is <span class="kw">not used</span> or is consistently used inappropriately. Conclusion is missing or not consistent.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs3" value="2" onchange="upd()"><span class="mark-tag">4-6</span><div class="txt-body">Terminology is used, but often <span class="kw">inappropriately</span>. A <span class="kw">simplistic conclusion</span> is included.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs3" value="3" onchange="upd()"><span class="mark-tag">7-9</span><div class="txt-body">Terminology used <span class="kw">sometimes appropriately</span>. Conclusion is included but is not always <span class="kw">consistent</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs3" value="4" onchange="upd()"><span class="mark-tag">10-12</span><div class="txt-body">Terminology used, <span class="kw">mostly appropriately</span>. The response argues to a conclusion that is <span class="kw">consistent</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p1cs3" value="5" onchange="upd()"><span class="mark-tag">13-15</span><div class="txt-body">There is <span class="kw">accurate and precise</span> use of terminology. The response argues to a <span class="kw">reasoned and clearly stated</span> conclusion.</div></label>
        </div>
        <div class="context-box">
            <label>Manual Mark Entry</label>
            <input type="number" class="manual-grade-field" id="man-p1c" oninput="upd()">
        </div>
        <textarea id="comm-p1c" placeholder="Comment" oninput="save()"></textarea>
    </div>

    <!-- PAPER 2 SECTION A -->
    <div id="p2aq1" class="view"><span class="guide-ref">Guide Page 53</span><h1>P2-A-Q1: Knowledge</h1><div class="header-anchor"></div><div class="card"><span class="strand-title">Knowledge (4m)</span>
        <label class="row-opt"><input type="radio" name="p2aq1r" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">Demonstrates <span class="kw">limited knowledge</span> of research methodology; terminology contains inaccuracies.</div></label>
        <label class="row-opt"><input type="radio" name="p2aq1r" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">Demonstrates <span class="kw">detailed knowledge</span>; terminology is <span class="kw">used accurately</span>.</div></label>
    </div><input type="number" class="manual-grade-field" id="man-p2aq1" oninput="upd()"><textarea id="comm-p2aq1" placeholder="Comment" oninput="save()"></textarea></div>

    <div id="p2aq2" class="view"><span class="guide-ref">Guide Page 53</span><h1>P2-A-Q2: Application</h1><div class="header-anchor"></div><div class="card"><span class="strand-title">Application (4m)</span>
        <label class="row-opt"><input type="radio" name="p2aq2r" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">Knowledge is <span class="kw">relevant but limited</span>. <span class="kw">Some links</span> between concept and practical.</div></label>
        <label class="row-opt"><input type="radio" name="p2aq2r" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">Knowledge is <span class="kw">well developed</span>. <span class="kw">Clear and detailed</span> links back to practical.</div></label>
    </div><input type="number" class="manual-grade-field" id="man-p2aq2" oninput="upd()"><textarea id="comm-p2aq2" placeholder="Comment" oninput="save()"></textarea></div>

    <div id="p2aq3" class="view"><span class="guide-ref">Guide Page 53-54</span><h1>P2-A-Q3: Compare</h1><div class="header-anchor"></div><div class="card"><span class="strand-title">Methodology (6m)</span>
        <label class="row-opt"><input type="radio" name="p2aq3r" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">Described in <span class="kw">limited detail</span>; inaccuracies or limited terminology.</div></label>
        <label class="row-opt"><input type="radio" name="p2aq3r" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">Explained in <span class="kw">limited detail</span>; lacks clarity. Terminology with some inaccuracies.</div></label>
        <label class="row-opt"><input type="radio" name="p2aq3r" value="3" onchange="upd()"><span class="mark-tag">5-6</span><div class="txt-body">Similarities and differences <span class="kw">discussed in detail</span>. Terminology used <span class="kw">effectively</span>.</div></label>
    </div><input type="number" class="manual-grade-field" id="man-p2aq3" oninput="upd()"><textarea id="comm-p2aq3" placeholder="Comment" oninput="save()"></textarea></div>

    <div id="p2aq4" class="view"><span class="guide-ref">Guide Page 54</span><h1>P2-A-Q4: Design</h1><div class="header-anchor"></div><div class="card"><span class="strand-title">Procedure (6m)</span>
        <label class="row-opt"><input type="radio" name="p2aq4r" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">The procedure is described in <span class="kw">limited detail</span>; limited use of terminology.</div></label>
        <label class="row-opt"><input type="radio" name="p2aq4r" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">The procedure is explained in <span class="kw">some detail but lacks clarity</span>. Terminology with inaccuracies.</div></label>
        <label class="row-opt"><input type="radio" name="p2aq4r" value="3" onchange="upd()"><span class="mark-tag">5-6</span><div class="txt-body">The procedure is explained with <span class="kw">accuracy and detail</span>. Terminology used <span class="kw">effectively</span>.</div></label>
    </div><input type="number" class="manual-grade-field" id="man-p2aq4" oninput="upd()"><textarea id="comm-p2aq4" placeholder="Comment" oninput="save()"></textarea></div>

    <!-- P2-B -->
    <div id="p2b" class="view">
        <span class="guide-ref">Guide Page 54-55</span>
        <h1>P2-B: Unseen Case Study</h1>
        <div class="header-anchor"></div>
        <div class="card">
            <span class="strand-title">Concept Understanding</span>
            <label class="row-opt"><input type="radio" name="p2bs1" value="1" onchange="upd()"><span class="mark-tag">1-3</span><div class="txt-body"><span class="kw">Little understanding</span> of specified concepts in relation to the study.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs1" value="2" onchange="upd()"><span class="mark-tag">4-6</span><div class="txt-body"><span class="kw">Basic understanding</span> of at least one specified concept.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs1" value="3" onchange="upd()"><span class="mark-tag">7-9</span><div class="txt-body"><span class="kw">Some understanding</span> of specified concepts. Knowledge <span class="kw">partly explained</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs1" value="4" onchange="upd()"><span class="mark-tag">10-12</span><div class="txt-body"><span class="kw">Good understanding</span> of at least two specified concepts.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs1" value="5" onchange="upd()"><span class="mark-tag">13-15</span><div class="txt-body"><span class="kw">Very good understanding</span> of two or more specified concepts.</div></label>
        </div>
        <div class="card">
            <span class="strand-title">Critical Analysis</span>
            <label class="row-opt"><input type="radio" name="p2bs2" value="1" onchange="upd()"><span class="mark-tag">1-3</span><div class="txt-body">Response is <span class="kw">descriptive</span>. Analysis superficial. Links to source irrelevant.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs2" value="2" onchange="upd()"><span class="mark-tag">4-6</span><div class="txt-body">Limited analysis present. Links to source of <span class="kw">limited relevance</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs2" value="3" onchange="upd()"><span class="mark-tag">7-9</span><div class="txt-body">Analysis <span class="kw">lacks development</span>. Conclusion inconsistent.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs2" value="4" onchange="upd()"><span class="mark-tag">10-12</span><div class="txt-body">Contains critical analysis, although this <span class="kw">lacks development</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs2" value="5" onchange="upd()"><span class="mark-tag">13-15</span><div class="txt-body"><span class="kw">Well-developed critical analysis</span>. Effective and specific source references.</div></label>
        </div>
        <div class="card">
            <span class="strand-title">Terminology & Context</span>
            <label class="row-opt"><input type="radio" name="p2bs3" value="1" onchange="upd()"><span class="mark-tag">1-3</span><div class="txt-body">Terminology <span class="kw">not used</span> or points inaccurate. Conclusion missing.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs3" value="2" onchange="upd()"><span class="mark-tag">4-6</span><div class="txt-body">Terminology used with <span class="kw">inaccuracies</span>. Simplistic conclusion included.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs3" value="3" onchange="upd()"><span class="mark-tag">7-9</span><div class="txt-body">Terminology used <span class="kw">sometimes appropriately</span>. Points lack accuracy.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs3" value="4" onchange="upd()"><span class="mark-tag">10-12</span><div class="txt-body">Terminology used <span class="kw">mostly appropriately</span>. Relevant points are made.</div></label>
            <label class="row-opt"><input type="radio" name="p2bs3" value="5" onchange="upd()"><span class="mark-tag">13-15</span><div class="txt-body"><span class="kw">Accurate and precise</span> terminology. Reasoned conclusion.</div></label>
        </div>
        <input type="number" class="manual-grade-field" id="man-p2b" oninput="upd()"><textarea id="comm-p2b" placeholder="Comment" oninput="save()"></textarea>
    </div>

    <!-- PAPER 3 -->
    <div id="p3q1" class="view"><span class="guide-ref">Guide Page 56</span><h1>P3-Q1: Graph Interpretation</h1><div class="header-anchor"></div><div class="card"><span class="strand-title">Issue Identification (3m)</span>
        <label class="row-opt"><input type="radio" name="p3q1r" value="1" onchange="upd()"><span class="mark-tag">1</span><div class="txt-body">A relevant issue that limits the interpretation is <span class="kw">identified</span>.</div></label>
        <label class="row-opt"><input type="radio" name="p3q1r" value="2" onchange="upd()"><span class="mark-tag">2</span><div class="txt-body">A relevant issue that limits the interpretation is <span class="kw">clearly described</span>.</div></label>
        <label class="row-opt"><input type="radio" name="p3q1r" value="3" onchange="upd()"><span class="mark-tag">3</span><div class="txt-body">A relevant issue that limits the interpretation is <span class="kw">fully explained</span>.</div></label>
    </div><input type="number" class="manual-grade-field" id="man-p3q1" oninput="upd()"><textarea id="comm-p3q1" placeholder="Comment" oninput="save()"></textarea></div>

    <div id="p3q2" class="view"><span class="guide-ref">Guide Page 56</span><h1>P3-Q2: Conclusion/Analysis</h1><div class="header-anchor"></div><div class="card"><span class="strand-title">Data Analysis (6m)</span>
        <label class="row-opt"><input type="radio" name="p3q2r" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">Limited analysis of data. Conclusion attempted but <span class="kw">not relevant</span>.</div></label>
        <label class="row-opt"><input type="radio" name="p3q2r" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">Analysis accurate but <span class="kw">lacks detail</span>. Link lacks clarity.</div></label>
        <label class="row-opt"><input type="radio" name="p3q2r" value="3" onchange="upd()"><span class="mark-tag">5-6</span><div class="txt-body">The data is <span class="kw">analysed in detail</span>. Conclusion is <span class="kw">explicitly linked</span>.</div></label>
    </div><input type="number" class="manual-grade-field" id="man-p3q2" oninput="upd()"><textarea id="comm-p3q2" placeholder="Comment" oninput="save()"></textarea></div>

    <div id="p3q3" class="view"><span class="guide-ref">Guide Page 56-57</span><h1>P3-Q3: Research Ethics</h1><div class="header-anchor"></div><div class="card"><span class="strand-title">Discussion quality (6m)</span>
        <label class="row-opt"><input type="radio" name="p3q3r" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">Discussion shows <span class="kw">limited understanding</span>. Evidence is missing.</div></label>
        <label class="row-opt"><input type="radio" name="p3q3r" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">Discussion shows <span class="kw">some understanding</span>. Link to source is <span class="kw">implicit</span>.</div></label>
        <label class="row-opt"><input type="radio" name="p3q3r" value="3" onchange="upd()"><span class="mark-tag">5-6</span><div class="txt-body">Discussion shows <span class="kw">detailed understanding</span>. Link to source is <span class="kw">explicit</span>.</div></label>
    </div><input type="number" class="manual-grade-field" id="man-p3q3" oninput="upd()"><textarea id="comm-p3q3" placeholder="Comment" oninput="save()"></textarea></div>

    <div id="p3q4" class="view">
        <span class="guide-ref">Guide Page 57-58</span>
        <h1>P3-Q4: HL Synthesis</h1>
        <div class="header-anchor"></div>
        <div class="card">
            <span class="strand-title">Integration & Interpretation</span>
            <label class="row-opt"><input type="radio" name="p3q4s1" value="1" onchange="upd()"><span class="mark-tag">1-3</span><div class="txt-body">Knowledge is <span class="kw">anecdotal</span> or of very marginal relevance.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s1" value="2" onchange="upd()"><span class="mark-tag">4-6</span><div class="txt-body">Relevant knowledge interpreted with inaccuracies. <span class="kw">Limited discussion</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s1" value="3" onchange="upd()"><span class="mark-tag">7-9</span><div class="txt-body">Interprets at least <span class="kw">two sources</span>. Discussion of validity is <span class="kw">limited</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s1" value="4" onchange="upd()"><span class="mark-tag">10-12</span><div class="txt-body">Interprets two or more sources. Discussion of validity has <span class="kw">some detail</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s1" value="5" onchange="upd()"><span class="mark-tag">13-15</span><div class="txt-body">Interprets at least <span class="kw">three sources effectively</span>. Detailed validity discussion.</div></label>
        </div>
        <div class="card">
            <span class="strand-title">Analysis of Claim</span>
            <label class="row-opt"><input type="radio" name="p3q4s2" value="1" onchange="upd()"><span class="mark-tag">1-3</span><div class="txt-body">Response is <span class="kw">mostly descriptive</span>. Any analysis is superficial.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s2" value="2" onchange="upd()"><span class="mark-tag">4-6</span><div class="txt-body">Limited analysis present. Discussion of validity is <span class="kw">limited</span>.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s2" value="3" onchange="upd()"><span class="mark-tag">7-9</span><div class="txt-body">Analysis <span class="kw">lacks development</span>. Conclusion only partially supported.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s2" value="4" onchange="upd()"><span class="mark-tag">10-12</span><div class="txt-body">Contains <span class="kw">critical analysis</span>. Relevant knowledge used to support.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s2" value="5" onchange="upd()"><span class="mark-tag">13-15</span><div class="txt-body">Contains <span class="kw">well-developed critical analysis</span>. Detailed relevant knowledge.</div></label>
        </div>
        <div class="card">
            <span class="strand-title">Evaluation of Perspectives</span>
            <label class="row-opt"><input type="radio" name="p3q4s3" value="1" onchange="upd()"><span class="mark-tag">1-3</span><div class="txt-body"><span class="kw">Little/no discussion</span> of different points of view.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s3" value="2" onchange="upd()"><span class="mark-tag">4-6</span><div class="txt-body">Discussion of POV <span class="kw">simplistic</span>. Conclusion missing.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s3" value="3" onchange="upd()"><span class="mark-tag">7-9</span><div class="txt-body">Different points of view <span class="kw">identified</span>. Conclusion partially supported.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s3" value="4" onchange="upd()"><span class="mark-tag">10-12</span><div class="txt-body">Different points of view are <span class="kw">identified</span>. Argument is consistent.</div></label>
            <label class="row-opt"><input type="radio" name="p3q4s3" value="5" onchange="upd()"><span class="mark-tag">13-15</span><div class="txt-body">Different points of view are <span class="kw">evaluated</span>. Reasoned conclusion.</div></label>
        </div>
        <input type="number" class="manual-grade-field" id="man-p3q4" oninput="upd()"><textarea id="comm-p3q4" placeholder="Comment" oninput="save()"></textarea>
    </div>

    <!-- IA -->
    <div id="ia" class="view">
        <span class="guide-ref">Guide Page 64-65</span>
        <h1>IA: Research Proposal</h1>
        <div class="header-anchor"></div>
        <div class="card"><span class="strand-title">Crit A: Intro (6m)</span><label class="row-opt"><input type="radio" name="iaar" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">Aim <span class="kw">broad</span>. Problem stated. Research not relevant.</div></label><label class="row-opt"><input type="radio" name="iaar" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">Aim stated but <span class="kw">partially focused</span>. 2 studies linked.</div></label><label class="row-opt"><input type="radio" name="iaar" value="3" onchange="upd()"><span class="mark-tag">5-6</span><div class="txt-body">Aim <span class="kw">focused</span>. Impact explained. Studies relevant.</div></label></div>
        <div class="card"><span class="strand-title">Crit B: Method (6m)</span><label class="row-opt"><input type="radio" name="iabr" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">Method <span class="kw">errors</span>. Procedure unclear. Ethics not linked.</div></label><label class="row-opt"><input type="radio" name="iabr" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">Choice <span class="kw">described</span>. Ethical considerations are described.</div></label><label class="row-opt"><input type="radio" name="iabr" value="3" onchange="upd()"><span class="mark-tag">5-6</span><div class="txt-body">Choice <span class="kw">explained</span>. Procedure fully explained. Ethics linked.</div></label></div>
        <div class="card"><span class="strand-title">Crit C: Data (6m)</span><label class="row-opt"><input type="radio" name="iacr" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">Tool <span class="kw">contains errors</span>. Limited detail or relevance.</div></label><label class="row-opt"><input type="radio" name="iacr" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">Appropriate tool created. Decisions described.</div></label><label class="row-opt"><input type="radio" name="iacr" value="3" onchange="upd()"><span class="mark-tag">5-6</span><div class="txt-body">Effective tool created. Decisions explained.</div></label></div>
        <div class="card"><span class="strand-title">Crit D: Discussion (6m)</span><label class="row-opt"><input type="radio" name="iadr" value="1" onchange="upd()"><span class="mark-tag">1-2</span><div class="txt-body">Implications <span class="kw">not addressed</span>. Bias identified.</div></label><label class="row-opt"><input type="radio" name="iadr" value="2" onchange="upd()"><span class="mark-tag">3-4</span><div class="txt-body">Implications <span class="kw">partially addressed</span>. Bias described.</div></label><label class="row-opt"><input type="radio" name="iadr" value="3" onchange="upd()"><span class="mark-tag">5-6</span><div class="txt-body">Implications <span class="kw">fully explained</span>. Bias discussed.</div></label></div>
        <input type="number" class="manual-grade-field" id="man-ia" oninput="upd()"><textarea id="comm-ia" placeholder="Comment" oninput="save()"></textarea>
    </div>

    <!-- EXPORT MANAGER -->
    <div id="export" class="view">
        <h1>Export Manager</h1>
        <p class="desc">Only sections with rubrics selected or comments written are available for export. Question fields are ignored for this check.</p>
        <div class="card" id="export-list"></div>
        <div style="display:flex; gap:10px;">
            <button class="btn btn-blue" onclick="doExport('simple')">Download Simple Feedback</button>
            <button class="btn btn-green" onclick="doExport('ai')">Generate AI Student Prompt</button>
        </div>
    </div>

    <!-- HELP VIEW -->
    <div id="help" class="view">
        <h1>Help & Pedagogy</h1>
        <div class="card">
            <h3>Best-Fit Assessment Strategy</h3>
            <p>This tool utilizes a <strong>strand-based Best-Fit Model</strong>. By evaluating Knowledge, Analysis, and Terminology independently, the tool identifies the "center of gravity" of a student's performance. This ensures that a student who excels in terminology but struggles with analysis receives a fair and balanced mark range based on 2027 curriculum standards.</p>
            <h3>Utility of Export Options</h3>
            <p><strong>Option 1: Simple Feedback</strong><br>Translates your selections into a formal, structured list. Ideal for report cards or formal record-keeping.</p>
            <p><strong>Option 2: AI Drafting Prompt</strong><br>Packages your feedback into a pedagogical instruction for the student to use with an LLM. It helps them understand the <b>Keyword Shift</b> (e.g., evolving a "limited" point into a "detailed" explanation) and provides strategies anchored to the question topic.</p>
        </div>
    </div>

    <!-- BOTTOM DOCK -->
    <div class="dock-bar">
        <div class="fit-info">
            <h3 id="fit-title">Select descriptors...</h3>
            <p id="fit-logic">Best-fit logic evaluates the majority achievement level across strands.</p>
        </div>
        <div class="res-box">
            <span class="res-val" id="score-out">0</span>
            <span class="res-lbl">Best Fit Mark</span>
        </div>
    </div>

</div>

<script>
    const STORAGE = 'psych_marker_2027_v2';

    // Inject headers
    document.querySelectorAll('.view:not(#export):not(#help)').forEach(v => {
        const anchor = v.querySelector('.header-anchor');
        const clone = document.getElementById('section-header').content.cloneNode(true);
        v.insertBefore(clone, anchor);
    });

    function nav(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('#sidebar a').forEach(a => a.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        const btn = document.getElementById('btn-' + id);
        if(btn) btn.classList.add('active');
        window.scrollTo(0,0);
        if(id === 'export') renderExport();
        upd();
    }

    function upd() {
        const active = document.querySelector('.view.active');
        if(!active || ['export','help'].includes(active.id)) return;

        const manField = active.querySelector('.manual-grade-field');
        const checked = active.querySelectorAll('input[type="radio"]:checked');
        const display = document.getElementById('score-out');
        const title = document.getElementById('fit-title');

        if(manField && manField.value !== "") {
            display.innerText = manField.value;
            title.innerText = "Manual Teacher Entry";
            save();
            return;
        }

        if (checked.length === 0) { display.innerText = "0"; title.innerText = "Select descriptors..."; return; }

        let totalPoints = 0; checked.forEach(r => totalPoints += parseFloat(r.value));
        let avg = totalPoints / checked.length;
        let vid = active.id;

        if(['p1c', 'p2b', 'p3q4'].includes(vid)) {
            const ranges = ["0", "1-3", "4-6", "7-9", "10-12", "13-15"];
            const names = ["N/A", "Rudimentary", "Basic", "Satisfactory", "Good", "Excellent"];
            let i = Math.round(avg);
            display.innerText = ranges[i];
            title.innerText = names[i];
        } else if (['p1a','p2aq1','p2aq2','p3q1'].includes(vid)) {
            display.innerText = Math.round(avg * 2);
            title.innerText = avg > 1.5 ? "Strong" : "Developing";
        } else {
            display.innerText = Math.round(avg * 2);
            title.innerText = avg > 2.5 ? "High Achievement" : "Partial Achievement";
        }
        save();
    }

    function save() {
        const data = {};
        document.querySelectorAll('input[type="radio"]:checked').forEach(r => data[r.name] = r.value);
        document.querySelectorAll('textarea, .q-field, .manual-grade-field').forEach(t => {
            const id = t.id || t.className+t.closest('.view').id;
            data[id] = t.value;
        });
        localStorage.setItem(STORAGE, JSON.stringify(data));
    }

    function load() {
        const raw = localStorage.getItem(STORAGE); if(!raw) return;
        const data = JSON.parse(raw);
        for(let k in data) {
            const rad = document.querySelector(`input[name="${k}"][value="${data[k]}"]`);
            if(rad) rad.checked = true;
            const fields = document.querySelectorAll('textarea, .q-field, .manual-grade-field');
            fields.forEach(f => {
                if((f.id === k) || (f.className+f.closest('.view').id === k)) f.value = data[k];
            });
        }
        upd();
    }

    function resetRubrics() {
        if(confirm("Reset rubrics and comments? Questions will remain.")) {
            document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
            document.querySelectorAll('textarea').forEach(t => t.value = "");
            document.querySelectorAll('.manual-grade-field').forEach(m => m.value = "");
            save();
            upd();
        }
    }

    function resetAll() {
        if(confirm("Full Reset: Clear all data including questions?")) {
            localStorage.removeItem(STORAGE);
            location.reload();
        }
    }

    function renderExport() {
        const list = document.getElementById('export-list');
        list.innerHTML = "";
        document.querySelectorAll('.view').forEach(v => {
            if(['export','help'].includes(v.id)) return;
            const hasMarking = v.querySelectorAll('input[type="radio"]:checked').length > 0;
            const hasComment = v.querySelector('textarea').value.trim() !== "";
            const isCompleted = hasMarking || hasComment;
            
            const row = document.createElement('div');
            row.className = `export-row ${!isCompleted ? 'disabled' : ''}`;
            row.innerHTML = `<input type="checkbox" id="chk-${v.id}" ${isCompleted ? 'checked' : ''}> <label>${v.querySelector('h1').innerText}</label>`;
            list.appendChild(row);
        });
    }

    function doExport(type) {
        let text = "IB PSYCHOLOGY 2027 ASSESSMENT FEEDBACK\n======================================\n\n";
        document.querySelectorAll('.view').forEach(v => {
            const chk = document.getElementById('chk-'+v.id);
            if(chk && chk.checked) {
                const q = v.querySelector('.q-field').value;
                const man = v.querySelector('.manual-grade-field').value;
                text += `COMPONENT: ${v.querySelector('h1').innerText}\n`;
                if(q) text += `QUESTION: ${q}\n`;
                v.querySelectorAll('input[type="radio"]:checked').forEach(r => {
                    text += `- ${r.closest('.card').querySelector('.strand-title').innerText}: ${r.parentElement.innerText.trim()}\n`;
                });
                if(man) text += `TEACHER MARK: ${man}\n`;
                const comm = v.querySelector('textarea').value;
                if(comm) text += `TEACHER COMMENT: ${comm}\n`;
                text += "\n---\n";
            }
        });

        if(type === 'ai') {
            text = `ACT AS AN IB PSYCHOLOGY TUTOR (2027 GUIDE). 
I am a student draft-marking. Here is my feedback data.

FEEDBACK:
${text}

TASK:
1. Explain exactly what the "Keyword Shift" (e.g. from 'Partial' to 'Detailed') means for my psychology writing.
2. Provide 3 high-impact drafting strategies for these criteria.
3. Keep advice focused strictly on the First Assessment 2027 curriculum.`;
        }

        const blob = new Blob([text], {type: "text/plain"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `IBPsych_Feedback_${type}.txt`;
        a.click();
    }

    window.onload = load;
</script>
</body>
</html>